@model zavrsni.Models.PageDetailModel
@using zavrsni.Helpers
@{
    ViewBag.Title = "Details";
}


<h2>@Model.PageName (avg. @Model.AverageGrade)</h2>
@if (Request.IsAuthenticated)
        {
    using (Html.BeginForm())
     {
         @Html.AntiForgeryToken()
         <div class="row">
             <div class="col-md-3" style="margin-top: 18px;">
                 @Html.DropDownListFor(model => model.Grade, new SelectList(
                     new List<Object>
                     {
                         new {value = 1, text = "1"},
                         new {value = 2, text = "2"},
                         new {value = 3, text = "3"},
                         new {value = 4, text = "4"},
                         new {value = 5, text = "5"}
                     },
                     "value",
                     "text",
                     2), "Select your mark:", new {@class = "form-control"})
             </div>
             <div class="col-md-4" style="margin-top: 18px;">

                 <div class="form-group">
                     <div class="col-md-12">
                         <input type="submit" class="btn btn-default" value="Submit"/>
                         <a href="@Url.Action("Index", "Page", new {Username = Model.Username})"><span class="btn btn-default">Return to pages list</span></a>
                     </div>
                 </div>
             </div>
         </div>
     }
        }


@if (!Request.IsAuthenticated)
{
    <div class="form-group">
        <div class="col-md-12">
            @Html.ActionLink("Return to homepage", "Index", "Home", new {area = ""}, new {@class = "btn btn-default"})
        </div>
    </div>
}

@foreach (var c in Model.PageContents.GroupBy(a => a.City.CityName))
{
    <p><h3>@c.Key</h3></p>

    <div class="row">
        <div id="container" class="js-masonry" data-masonry-options='{ "columnWidth": 280, "itemSelector": ".item" }'>
            @foreach (var item in c)
            {
                <div class="col-md-4 col-sm-6 item">
                    <div class="thumbnail content" style="padding: 2px 2px 2px 2px !important;">
                        <div class="caption" style="padding: 3px 3px 3px 3px !important;">
                            <h2>@item.Content.Title</h2>
                            @Html.Raw(item.Content.Text.ParseHTML().Truncate())
                            @if (item.Content.Text.ParseHTML().Truncate().Contains("..."))
                            {
                                <span> (<a href="@Url.Action("Details", "Content", new {IDcontent = item.Content.IDcontent, Username = Model.Username})">more</a>)</span>
                            }
                            @if (Request.IsAuthenticated)
                            {
                                <div class="text-right">
                                    <a href="@Url.Action("Edit", "Content", new {IDcontent = item.Content.IDcontent, Username = Model.Username})" target="_blank"><span class="btn btn-special glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
                                    <a href="@Url.Action("Details", "Content", new {IDcontent = item.Content.IDcontent, Username = Model.Username})" target="_blank"><span class="btn btn-special glyphicon glyphicon-list" aria-hidden="true"></span></a>
                                    <a href="@Url.Action("DeleteContent", "Page", new {IDcontent = item.Content.IDcontent, IDpage = Model.IDpage, Username = Model.Username})"><span class="btn btn-special glyphicon glyphicon-remove" aria-hidden="true"></span></a>
                                </div>
                            }
                            else
                            {
                                <div class="text-right">
                                    <a href="@Url.Action("Details", "Content", new {IDcontent = item.Content.IDcontent, Username = Model.Username})" target="_blank"><span class="btn btn-special glyphicon glyphicon-list" aria-hidden="true"></span></a>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }
            @*<strong>@c.Location.IDcity</strong>
                <p>@Html.Raw(c.Content.Text)
                --------------</p>*@
        </div>
    </div>
}
